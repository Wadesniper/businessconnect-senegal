{"ast":null,"code":"import{marketplaceData}from'../data/marketplaceData';import{subscriptionData}from'../data/subscriptionData';const STORAGE_KEY='marketplace_items';function getStoredItems(){const stored=localStorage.getItem(STORAGE_KEY);if(stored)return JSON.parse(stored);// Si rien en localStorage, on initialise avec les données statiques\nlocalStorage.setItem(STORAGE_KEY,JSON.stringify(marketplaceData));return[...marketplaceData];}function saveItems(items){localStorage.setItem(STORAGE_KEY,JSON.stringify(items));}function getUserSubscription(userId){// On peut aussi stocker les abonnements dans le localStorage si besoin\nreturn subscriptionData.find(sub=>sub.userId===userId);}function isUserSubscribed(userId){const sub=getUserSubscription(userId);if(!sub)return false;if(!sub.isActive)return false;if(new Date(sub.expiresAt)<new Date())return false;return true;}export const marketplaceService={async getItems(filters){let items=getStoredItems();// Filtrer pour ne garder que les annonces dont le propriétaire est abonné\nitems=items.filter(i=>isUserSubscribed(i.userId));if(filters){if(filters.category)items=items.filter(i=>i.category===filters.category);if(filters.location)items=items.filter(i=>i.location.toLowerCase().includes(filters.location.toLowerCase()));if(filters.search)items=items.filter(i=>i.title.toLowerCase().includes(filters.search.toLowerCase())||i.description.toLowerCase().includes(filters.search.toLowerCase()));if(filters.minPrice!==undefined)items=items.filter(i=>i.price>=filters.minPrice);if(filters.maxPrice!==undefined)items=items.filter(i=>i.price<=filters.maxPrice);}return Promise.resolve(items);},async getItem(id){const items=getStoredItems();const item=items.find(i=>i.id===id)||null;// Vérifier l'abonnement du propriétaire\nif(item&&!isUserSubscribed(item.userId))return null;return Promise.resolve(item);},async createItem(itemData){// Vérifier l'abonnement de l'utilisateur\nif(!isUserSubscribed(itemData.userId)){return Promise.reject(new Error('Votre abonnement n\\'est pas actif. Veuillez vous abonner pour publier une annonce.'));}const items=getStoredItems();const newItem={...itemData,id:(Date.now()+Math.random()).toString(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),status:'active'};items.unshift(newItem);saveItems(items);return Promise.resolve(newItem);},async updateItem(id,itemData){const items=getStoredItems();const idx=items.findIndex(i=>i.id===id);if(idx===-1)throw new Error('Annonce non trouvée');const updated={...items[idx],...itemData,updatedAt:new Date().toISOString()};items[idx]=updated;saveItems(items);return Promise.resolve(updated);},async deleteItem(id){let items=getStoredItems();items=items.filter(i=>i.id!==id);saveItems(items);return Promise.resolve();},async uploadImage(file){// Mock : retourne une URL d'image aléatoire Unsplash\nreturn Promise.resolve('https://source.unsplash.com/random/400x300?sig='+Math.floor(Math.random()*10000));}};","map":{"version":3,"names":["marketplaceData","subscriptionData","STORAGE_KEY","getStoredItems","stored","localStorage","getItem","JSON","parse","setItem","stringify","saveItems","items","getUserSubscription","userId","find","sub","isUserSubscribed","isActive","Date","expiresAt","marketplaceService","getItems","filters","filter","i","category","location","toLowerCase","includes","search","title","description","minPrice","undefined","price","maxPrice","Promise","resolve","id","item","createItem","itemData","reject","Error","newItem","now","Math","random","toString","createdAt","toISOString","updatedAt","status","unshift","updateItem","idx","findIndex","updated","deleteItem","uploadImage","file","floor"],"sources":["C:/Users/babac/OneDrive/Bureau/businessconnect-senegal-main/businessconnect-senegal/client/src/services/marketplaceService.ts"],"sourcesContent":["import { marketplaceData } from '../data/marketplaceData';\r\nimport { subscriptionData, UserSubscription } from '../data/subscriptionData';\r\n\r\nexport interface MarketplaceItem {\r\n  id: string;\r\n  title: string;\r\n  description: string;\r\n  price: number;\r\n  category: string;\r\n  images: string[];\r\n  location: string;\r\n  contactInfo: {\r\n    email: string;\r\n    phone?: string;\r\n  };\r\n  userId: string;\r\n  createdAt: string;\r\n  updatedAt: string;\r\n  status: 'active' | 'sold' | 'expired';\r\n}\r\n\r\nexport interface MarketplaceFilters {\r\n  category?: string;\r\n  minPrice?: number;\r\n  maxPrice?: number;\r\n  search?: string;\r\n  location?: string;\r\n}\r\n\r\nconst STORAGE_KEY = 'marketplace_items';\r\n\r\nfunction getStoredItems(): MarketplaceItem[] {\r\n  const stored = localStorage.getItem(STORAGE_KEY);\r\n  if (stored) return JSON.parse(stored);\r\n  // Si rien en localStorage, on initialise avec les données statiques\r\n  localStorage.setItem(STORAGE_KEY, JSON.stringify(marketplaceData));\r\n  return [...marketplaceData];\r\n}\r\n\r\nfunction saveItems(items: MarketplaceItem[]) {\r\n  localStorage.setItem(STORAGE_KEY, JSON.stringify(items));\r\n}\r\n\r\nfunction getUserSubscription(userId: string): UserSubscription | undefined {\r\n  // On peut aussi stocker les abonnements dans le localStorage si besoin\r\n  return subscriptionData.find(sub => sub.userId === userId);\r\n}\r\n\r\nfunction isUserSubscribed(userId: string): boolean {\r\n  const sub = getUserSubscription(userId);\r\n  if (!sub) return false;\r\n  if (!sub.isActive) return false;\r\n  if (new Date(sub.expiresAt) < new Date()) return false;\r\n  return true;\r\n}\r\n\r\nexport const marketplaceService = {\r\n  async getItems(filters?: MarketplaceFilters): Promise<MarketplaceItem[]> {\r\n    let items = getStoredItems();\r\n    // Filtrer pour ne garder que les annonces dont le propriétaire est abonné\r\n    items = items.filter(i => isUserSubscribed(i.userId));\r\n    if (filters) {\r\n      if (filters.category) items = items.filter(i => i.category === filters.category);\r\n      if (filters.location) items = items.filter(i => i.location.toLowerCase().includes(filters.location.toLowerCase()));\r\n      if (filters.search) items = items.filter(i => i.title.toLowerCase().includes(filters.search.toLowerCase()) || i.description.toLowerCase().includes(filters.search.toLowerCase()));\r\n      if (filters.minPrice !== undefined) items = items.filter(i => i.price >= filters.minPrice!);\r\n      if (filters.maxPrice !== undefined) items = items.filter(i => i.price <= filters.maxPrice!);\r\n    }\r\n    return Promise.resolve(items);\r\n  },\r\n\r\n  async getItem(id: string): Promise<MarketplaceItem | null> {\r\n    const items = getStoredItems();\r\n    const item = items.find(i => i.id === id) || null;\r\n    // Vérifier l'abonnement du propriétaire\r\n    if (item && !isUserSubscribed(item.userId)) return null;\r\n    return Promise.resolve(item);\r\n  },\r\n\r\n  async createItem(itemData: Omit<MarketplaceItem, 'id' | 'createdAt' | 'updatedAt' | 'status'>): Promise<MarketplaceItem> {\r\n    // Vérifier l'abonnement de l'utilisateur\r\n    if (!isUserSubscribed(itemData.userId)) {\r\n      return Promise.reject(new Error('Votre abonnement n\\'est pas actif. Veuillez vous abonner pour publier une annonce.'));\r\n    }\r\n    const items = getStoredItems();\r\n    const newItem: MarketplaceItem = {\r\n      ...itemData,\r\n      id: (Date.now() + Math.random()).toString(),\r\n      createdAt: new Date().toISOString(),\r\n      updatedAt: new Date().toISOString(),\r\n      status: 'active'\r\n    };\r\n    items.unshift(newItem);\r\n    saveItems(items);\r\n    return Promise.resolve(newItem);\r\n  },\r\n\r\n  async updateItem(id: string, itemData: Partial<MarketplaceItem>): Promise<MarketplaceItem> {\r\n    const items = getStoredItems();\r\n    const idx = items.findIndex(i => i.id === id);\r\n    if (idx === -1) throw new Error('Annonce non trouvée');\r\n    const updated: MarketplaceItem = {\r\n      ...items[idx],\r\n      ...itemData,\r\n      updatedAt: new Date().toISOString()\r\n    };\r\n    items[idx] = updated;\r\n    saveItems(items);\r\n    return Promise.resolve(updated);\r\n  },\r\n\r\n  async deleteItem(id: string): Promise<void> {\r\n    let items = getStoredItems();\r\n    items = items.filter(i => i.id !== id);\r\n    saveItems(items);\r\n    return Promise.resolve();\r\n  },\r\n\r\n  async uploadImage(file: File): Promise<string> {\r\n    // Mock : retourne une URL d'image aléatoire Unsplash\r\n    return Promise.resolve('https://source.unsplash.com/random/400x300?sig=' + Math.floor(Math.random()*10000));\r\n  }\r\n}; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}