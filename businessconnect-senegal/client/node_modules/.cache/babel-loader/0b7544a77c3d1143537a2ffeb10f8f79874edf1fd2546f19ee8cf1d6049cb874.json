{"ast":null,"code":"import React,{useState,useEffect}from'react';import{Table,Button,Space,Modal,message,Tag,Input,Typography}from'antd';import{adminService}from'../../../services/adminService';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const{TextArea}=Input;const{Title,Paragraph}=Typography;const ForumModeration=()=>{const[posts,setPosts]=useState([]);const[loading,setLoading]=useState(true);const[pagination,setPagination]=useState({current:1,pageSize:10,total:0});const[selectedPost,setSelectedPost]=useState(null);const[rejectReason,setRejectReason]=useState('');const[isModalVisible,setIsModalVisible]=useState(false);const fetchPosts=async function(){let page=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;let pageSize=arguments.length>1&&arguments[1]!==undefined?arguments[1]:10;try{setLoading(true);const response=await adminService.getForumPosts(page,pageSize);setPosts(response.data);setPagination({current:page,pageSize,total:response.total});}catch(error){message.error('Erreur lors du chargement des posts');}finally{setLoading(false);}};useEffect(()=>{fetchPosts();},[]);const handleTableChange=pagination=>{fetchPosts(pagination.current,pagination.pageSize);};const handleModeration=async(postId,action)=>{try{await adminService.moderatePost(postId,action,action==='reject'?rejectReason:undefined);message.success(`Post ${action==='approve'?'approuvé':'rejeté'} avec succès`);setIsModalVisible(false);setRejectReason('');fetchPosts(pagination.current,pagination.pageSize);}catch(error){message.error('Erreur lors de la modération');}};const showRejectModal=post=>{setSelectedPost(post);setIsModalVisible(true);};const getStatusColor=status=>{switch(status){case'approved':return'green';case'rejected':return'red';default:return'orange';}};const columns=[{title:'Titre',dataIndex:'title',key:'title'},{title:'Auteur',dataIndex:'author',key:'author'},{title:'Catégorie',dataIndex:'category',key:'category',render:category=>/*#__PURE__*/_jsx(Tag,{color:\"blue\",children:category})},{title:'Statut',dataIndex:'status',key:'status',render:status=>/*#__PURE__*/_jsx(Tag,{color:getStatusColor(status),children:status})},{title:'Date de création',dataIndex:'createdAt',key:'createdAt',render:date=>new Date(date).toLocaleDateString()},{title:'Signalements',dataIndex:'reports',key:'reports',render:reports=>/*#__PURE__*/_jsx(Tag,{color:reports>0?'red':'green',children:reports})},{title:'Actions',key:'actions',render:(_,record)=>/*#__PURE__*/_jsxs(Space,{children:[/*#__PURE__*/_jsx(Button,{type:\"primary\",onClick:()=>handleModeration(record.id,'approve'),disabled:record.status==='approved',children:\"Approuver\"}),/*#__PURE__*/_jsx(Button,{danger:true,onClick:()=>showRejectModal(record),disabled:record.status==='rejected',children:\"Rejeter\"}),/*#__PURE__*/_jsx(Button,{onClick:()=>Modal.info({title:'Contenu du post',content:/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Titre:\"}),\" \",record.title]}),/*#__PURE__*/_jsx(\"p\",{children:/*#__PURE__*/_jsx(\"strong\",{children:\"Contenu:\"})}),/*#__PURE__*/_jsx(\"p\",{children:record.content})]}),width:600}),children:\"Voir le contenu\"})]})}];return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Title,{level:4,children:\"Mod\\xE9ration du Forum\"}),/*#__PURE__*/_jsx(Table,{columns:columns,dataSource:posts,rowKey:\"id\",pagination:pagination,loading:loading,onChange:handleTableChange}),/*#__PURE__*/_jsx(Modal,{title:\"Raison du rejet\",visible:isModalVisible,onOk:()=>selectedPost&&handleModeration(selectedPost.id,'reject'),onCancel:()=>{setIsModalVisible(false);setRejectReason('');},okText:\"Confirmer\",cancelText:\"Annuler\",children:/*#__PURE__*/_jsx(TextArea,{rows:4,value:rejectReason,onChange:e=>setRejectReason(e.target.value),placeholder:\"Veuillez indiquer la raison du rejet...\"})})]});};export default ForumModeration;","map":{"version":3,"names":["React","useState","useEffect","Table","Button","Space","Modal","message","Tag","Input","Typography","adminService","jsx","_jsx","jsxs","_jsxs","TextArea","Title","Paragraph","ForumModeration","posts","setPosts","loading","setLoading","pagination","setPagination","current","pageSize","total","selectedPost","setSelectedPost","rejectReason","setRejectReason","isModalVisible","setIsModalVisible","fetchPosts","page","arguments","length","undefined","response","getForumPosts","data","error","handleTableChange","handleModeration","postId","action","moderatePost","success","showRejectModal","post","getStatusColor","status","columns","title","dataIndex","key","render","category","color","children","date","Date","toLocaleDateString","reports","_","record","type","onClick","id","disabled","danger","info","content","width","level","dataSource","rowKey","onChange","visible","onOk","onCancel","okText","cancelText","rows","value","e","target","placeholder"],"sources":["C:/Users/babac/OneDrive/Bureau/businessconnect-senegal-main/businessconnect-senegal/client/src/pages/admin/components/ForumModeration.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { \r\n  Table, \r\n  Button, \r\n  Space, \r\n  Modal, \r\n  message, \r\n  Tag, \r\n  Input,\r\n  Typography,\r\n  Card\r\n} from 'antd';\r\nimport { \r\n  CheckOutlined, \r\n  CloseOutlined, \r\n  EyeOutlined,\r\n  SearchOutlined \r\n} from '@ant-design/icons';\r\nimport { adminService } from '../../../services/adminService';\r\n\r\nconst { TextArea } = Input;\r\nconst { Title, Paragraph } = Typography;\r\n\r\ninterface ForumPost {\r\n  id: string;\r\n  title: string;\r\n  author: string;\r\n  content: string;\r\n  category: string;\r\n  status: 'pending' | 'approved' | 'rejected';\r\n  createdAt: string;\r\n  reports: number;\r\n}\r\n\r\nconst ForumModeration: React.FC = () => {\r\n  const [posts, setPosts] = useState<ForumPost[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [pagination, setPagination] = useState({ current: 1, pageSize: 10, total: 0 });\r\n  const [selectedPost, setSelectedPost] = useState<ForumPost | null>(null);\r\n  const [rejectReason, setRejectReason] = useState('');\r\n  const [isModalVisible, setIsModalVisible] = useState(false);\r\n\r\n  const fetchPosts = async (page = 1, pageSize = 10) => {\r\n    try {\r\n      setLoading(true);\r\n      const response = await adminService.getForumPosts(page, pageSize);\r\n      setPosts(response.data);\r\n      setPagination({\r\n        current: page,\r\n        pageSize,\r\n        total: response.total,\r\n      });\r\n    } catch (error) {\r\n      message.error('Erreur lors du chargement des posts');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    fetchPosts();\r\n  }, []);\r\n\r\n  const handleTableChange = (pagination: any) => {\r\n    fetchPosts(pagination.current, pagination.pageSize);\r\n  };\r\n\r\n  const handleModeration = async (postId: string, action: 'approve' | 'reject') => {\r\n    try {\r\n      await adminService.moderatePost(postId, action, action === 'reject' ? rejectReason : undefined);\r\n      message.success(`Post ${action === 'approve' ? 'approuvé' : 'rejeté'} avec succès`);\r\n      setIsModalVisible(false);\r\n      setRejectReason('');\r\n      fetchPosts(pagination.current, pagination.pageSize);\r\n    } catch (error) {\r\n      message.error('Erreur lors de la modération');\r\n    }\r\n  };\r\n\r\n  const showRejectModal = (post: ForumPost) => {\r\n    setSelectedPost(post);\r\n    setIsModalVisible(true);\r\n  };\r\n\r\n  const getStatusColor = (status: string) => {\r\n    switch (status) {\r\n      case 'approved':\r\n        return 'green';\r\n      case 'rejected':\r\n        return 'red';\r\n      default:\r\n        return 'orange';\r\n    }\r\n  };\r\n\r\n  const columns = [\r\n    {\r\n      title: 'Titre',\r\n      dataIndex: 'title',\r\n      key: 'title',\r\n    },\r\n    {\r\n      title: 'Auteur',\r\n      dataIndex: 'author',\r\n      key: 'author',\r\n    },\r\n    {\r\n      title: 'Catégorie',\r\n      dataIndex: 'category',\r\n      key: 'category',\r\n      render: (category: string) => (\r\n        <Tag color=\"blue\">{category}</Tag>\r\n      ),\r\n    },\r\n    {\r\n      title: 'Statut',\r\n      dataIndex: 'status',\r\n      key: 'status',\r\n      render: (status: string) => (\r\n        <Tag color={getStatusColor(status)}>{status}</Tag>\r\n      ),\r\n    },\r\n    {\r\n      title: 'Date de création',\r\n      dataIndex: 'createdAt',\r\n      key: 'createdAt',\r\n      render: (date: string) => new Date(date).toLocaleDateString(),\r\n    },\r\n    {\r\n      title: 'Signalements',\r\n      dataIndex: 'reports',\r\n      key: 'reports',\r\n      render: (reports: number) => (\r\n        <Tag color={reports > 0 ? 'red' : 'green'}>{reports}</Tag>\r\n      ),\r\n    },\r\n    {\r\n      title: 'Actions',\r\n      key: 'actions',\r\n      render: (_: any, record: ForumPost) => (\r\n        <Space>\r\n          <Button\r\n            type=\"primary\"\r\n            onClick={() => handleModeration(record.id, 'approve')}\r\n            disabled={record.status === 'approved'}\r\n          >\r\n            Approuver\r\n          </Button>\r\n          <Button\r\n            danger\r\n            onClick={() => showRejectModal(record)}\r\n            disabled={record.status === 'rejected'}\r\n          >\r\n            Rejeter\r\n          </Button>\r\n          <Button\r\n            onClick={() => Modal.info({\r\n              title: 'Contenu du post',\r\n              content: (\r\n                <div>\r\n                  <p><strong>Titre:</strong> {record.title}</p>\r\n                  <p><strong>Contenu:</strong></p>\r\n                  <p>{record.content}</p>\r\n                </div>\r\n              ),\r\n              width: 600,\r\n            })}\r\n          >\r\n            Voir le contenu\r\n          </Button>\r\n        </Space>\r\n      ),\r\n    },\r\n  ];\r\n\r\n  return (\r\n    <div>\r\n      <Title level={4}>Modération du Forum</Title>\r\n      <Table\r\n        columns={columns}\r\n        dataSource={posts}\r\n        rowKey=\"id\"\r\n        pagination={pagination}\r\n        loading={loading}\r\n        onChange={handleTableChange}\r\n      />\r\n\r\n      <Modal\r\n        title=\"Raison du rejet\"\r\n        visible={isModalVisible}\r\n        onOk={() => selectedPost && handleModeration(selectedPost.id, 'reject')}\r\n        onCancel={() => {\r\n          setIsModalVisible(false);\r\n          setRejectReason('');\r\n        }}\r\n        okText=\"Confirmer\"\r\n        cancelText=\"Annuler\"\r\n      >\r\n        <TextArea\r\n          rows={4}\r\n          value={rejectReason}\r\n          onChange={(e) => setRejectReason(e.target.value)}\r\n          placeholder=\"Veuillez indiquer la raison du rejet...\"\r\n        />\r\n      </Modal>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ForumModeration; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}