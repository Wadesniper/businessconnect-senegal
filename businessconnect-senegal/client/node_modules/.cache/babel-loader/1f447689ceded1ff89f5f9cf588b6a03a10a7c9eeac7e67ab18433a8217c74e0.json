{"ast":null,"code":"import React,{useState,useEffect}from'react';import{useNavigate}from'react-router-dom';import{Layout,Card,Row,Col,Input,Select,Button,Space,Typography,Slider,Modal,Form,Upload,message,Image}from'antd';import{SearchOutlined,PlusOutlined,UploadOutlined,EnvironmentOutlined,EuroOutlined}from'@ant-design/icons';import{marketplaceService}from'../../services/marketplaceService';import{authService}from'../../services/authService';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const{Title,Text}=Typography;const{Option}=Select;const{Content}=Layout;const categories=['Informatique','Électronique','Mode','Maison','Véhicules','Services','Autres'];const MarketplacePage=()=>{const navigate=useNavigate();const[items,setItems]=useState([]);const[loading,setLoading]=useState(true);const[isModalVisible,setIsModalVisible]=useState(false);const[form]=Form.useForm();const[filters,setFilters]=useState({category:undefined,minPrice:0,maxPrice:10000,search:'',location:''});useEffect(()=>{fetchItems();},[filters]);const fetchItems=async()=>{setLoading(true);try{const data=await marketplaceService.getItems(filters);setItems(data);}catch(error){message.error('Erreur lors de la récupération des annonces');}setLoading(false);};const handleCreateAd=async values=>{try{var _values$images;const user=authService.getCurrentUser();if(!user){message.error('Veuillez vous connecter pour créer une annonce');return;}const itemData={...values,userId:user.id,images:((_values$images=values.images)===null||_values$images===void 0?void 0:_values$images.fileList.map(file=>file.url))||[]};await marketplaceService.createItem(itemData);message.success('Annonce créée avec succès');setIsModalVisible(false);form.resetFields();fetchItems();}catch(error){message.error('Erreur lors de la création de l\\'annonce');}};const handleImageUpload=async file=>{try{const url=await marketplaceService.uploadImage(file);return url;}catch(error){message.error('Erreur lors du téléchargement de l\\'image');return'';}};return/*#__PURE__*/_jsx(Layout,{style:{padding:'24px'},children:/*#__PURE__*/_jsxs(Content,{children:[/*#__PURE__*/_jsxs(Row,{gutter:[24,24],children:[/*#__PURE__*/_jsx(Col,{span:24,children:/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsxs(Space,{direction:\"vertical\",style:{width:'100%'},children:[/*#__PURE__*/_jsx(Title,{level:2,children:\"Marketplace\"}),/*#__PURE__*/_jsxs(Row,{gutter:[16,16],children:[/*#__PURE__*/_jsx(Col,{span:6,children:/*#__PURE__*/_jsx(Select,{style:{width:'100%'},placeholder:\"Cat\\xE9gorie\",onChange:value=>setFilters({...filters,category:value}),allowClear:true,children:categories.map(category=>/*#__PURE__*/_jsx(Option,{value:category,children:category},category))})}),/*#__PURE__*/_jsx(Col,{span:6,children:/*#__PURE__*/_jsx(Input,{placeholder:\"Localisation\",prefix:/*#__PURE__*/_jsx(EnvironmentOutlined,{}),onChange:e=>setFilters({...filters,location:e.target.value})})}),/*#__PURE__*/_jsx(Col,{span:6,children:/*#__PURE__*/_jsx(Input,{placeholder:\"Rechercher...\",prefix:/*#__PURE__*/_jsx(SearchOutlined,{}),onChange:e=>setFilters({...filters,search:e.target.value})})}),/*#__PURE__*/_jsx(Col,{span:6,children:/*#__PURE__*/_jsx(Button,{type:\"primary\",icon:/*#__PURE__*/_jsx(PlusOutlined,{}),onClick:()=>setIsModalVisible(true),children:\"Cr\\xE9er une annonce\"})})]}),/*#__PURE__*/_jsx(Row,{children:/*#__PURE__*/_jsxs(Col,{span:24,children:[/*#__PURE__*/_jsx(Text,{children:\"Prix :\"}),/*#__PURE__*/_jsx(Slider,{range:true,min:0,max:10000,defaultValue:[0,10000],onChange:value=>setFilters({...filters,minPrice:value[0],maxPrice:value[1]})})]})})]})})}),items.map(item=>/*#__PURE__*/_jsx(Col,{xs:24,sm:12,md:8,lg:6,children:/*#__PURE__*/_jsx(Card,{hoverable:true,cover:item.images[0]?/*#__PURE__*/_jsx(Image,{alt:item.title,src:item.images[0],style:{height:200,objectFit:'cover'}}):null,onClick:()=>navigate(`/marketplace/${item.id}`),children:/*#__PURE__*/_jsx(Card.Meta,{title:item.title,description:/*#__PURE__*/_jsxs(Space,{direction:\"vertical\",children:[/*#__PURE__*/_jsxs(Text,{children:[item.description.substring(0,100),\"...\"]}),/*#__PURE__*/_jsxs(Space,{children:[/*#__PURE__*/_jsx(EuroOutlined,{}),/*#__PURE__*/_jsx(Text,{strong:true,children:item.price})]}),/*#__PURE__*/_jsxs(Space,{children:[/*#__PURE__*/_jsx(EnvironmentOutlined,{}),/*#__PURE__*/_jsx(Text,{children:item.location})]})]})})})},item.id))]}),/*#__PURE__*/_jsx(Modal,{title:\"Cr\\xE9er une nouvelle annonce\",visible:isModalVisible,onCancel:()=>setIsModalVisible(false),footer:null,children:/*#__PURE__*/_jsxs(Form,{form:form,layout:\"vertical\",onFinish:handleCreateAd,children:[/*#__PURE__*/_jsx(Form.Item,{name:\"title\",label:\"Titre\",rules:[{required:true,message:'Veuillez saisir un titre'}],children:/*#__PURE__*/_jsx(Input,{placeholder:\"Titre de l'annonce\"})}),/*#__PURE__*/_jsx(Form.Item,{name:\"description\",label:\"Description\",rules:[{required:true,message:'Veuillez saisir une description'}],children:/*#__PURE__*/_jsx(Input.TextArea,{rows:4,placeholder:\"Description d\\xE9taill\\xE9e\"})}),/*#__PURE__*/_jsx(Form.Item,{name:\"category\",label:\"Cat\\xE9gorie\",rules:[{required:true,message:'Veuillez sélectionner une catégorie'}],children:/*#__PURE__*/_jsx(Select,{placeholder:\"S\\xE9lectionnez une cat\\xE9gorie\",children:categories.map(category=>/*#__PURE__*/_jsx(Option,{value:category,children:category},category))})}),/*#__PURE__*/_jsx(Form.Item,{name:\"price\",label:\"Prix\",rules:[{required:true,message:'Veuillez saisir un prix'}],children:/*#__PURE__*/_jsx(Input,{type:\"number\",prefix:/*#__PURE__*/_jsx(EuroOutlined,{})})}),/*#__PURE__*/_jsx(Form.Item,{name:\"location\",label:\"Localisation\",rules:[{required:true,message:'Veuillez saisir une localisation'}],children:/*#__PURE__*/_jsx(Input,{prefix:/*#__PURE__*/_jsx(EnvironmentOutlined,{})})}),/*#__PURE__*/_jsx(Form.Item,{name:\"contactInfo\",label:\"Informations de contact\",rules:[{required:true,message:'Veuillez saisir les informations de contact'}],children:/*#__PURE__*/_jsxs(Input.Group,{children:[/*#__PURE__*/_jsx(Form.Item,{name:['contactInfo','email'],rules:[{required:true,message:'Veuillez saisir un email'},{type:'email',message:'Email invalide'}],children:/*#__PURE__*/_jsx(Input,{placeholder:\"Email\"})}),/*#__PURE__*/_jsx(Form.Item,{name:['contactInfo','phone'],children:/*#__PURE__*/_jsx(Input,{placeholder:\"T\\xE9l\\xE9phone (optionnel)\"})})]})}),/*#__PURE__*/_jsx(Form.Item,{name:\"images\",label:\"Images\",valuePropName:\"fileList\",getValueFromEvent:e=>{if(Array.isArray(e)){return e;}return e===null||e===void 0?void 0:e.fileList;},children:/*#__PURE__*/_jsx(Upload,{listType:\"picture-card\",beforeUpload:handleImageUpload,maxCount:5,children:/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(UploadOutlined,{}),/*#__PURE__*/_jsx(\"div\",{style:{marginTop:8},children:\"Upload\"})]})})}),/*#__PURE__*/_jsx(Form.Item,{children:/*#__PURE__*/_jsx(Button,{type:\"primary\",htmlType:\"submit\",children:\"Publier l'annonce\"})})]})})]})});};export default MarketplacePage;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}