{"ast":null,"code":"import React,{useState,useEffect}from'react';import{useParams,useNavigate}from'react-router-dom';import{Layout,Card,Button,Space,Avatar,Typography,Input,message,Tag,Divider}from'antd';import{LikeOutlined,MessageOutlined,FlagOutlined}from'@ant-design/icons';import{api}from'../../services/api';import{authService}from'../../services/authService';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const{Content}=Layout;const{TextArea}=Input;const{Title,Paragraph}=Typography;const DiscussionDetail=()=>{const{id}=useParams();const navigate=useNavigate();const[discussion,setDiscussion]=useState(null);const[loading,setLoading]=useState(true);const[replyContent,setReplyContent]=useState('');const[submitting,setSubmitting]=useState(false);useEffect(()=>{fetchDiscussion();},[id]);const fetchDiscussion=async()=>{try{const response=await api.get(`/forum/discussions/${id}`);setDiscussion(response.data);}catch(error){message.error('Erreur lors du chargement de la discussion');}finally{setLoading(false);}};const handleLike=async()=>{if(!authService.getToken()){message.warning('Veuillez vous connecter pour liker');navigate('/login');return;}try{await api.post(`/forum/discussions/${id}/like`);setDiscussion(prev=>prev?{...prev,likesCount:prev.likesCount+1}:null);}catch(error){message.error('Erreur lors du like');}};const handleReply=async()=>{if(!authService.getToken()){message.warning('Veuillez vous connecter pour répondre');navigate('/login');return;}if(!replyContent.trim()){message.warning('Veuillez entrer une réponse');return;}try{setSubmitting(true);await api.post(`/forum/discussions/${id}/replies`,{content:replyContent});setReplyContent('');fetchDiscussion();message.success('Réponse publiée avec succès !');}catch(error){message.error('Erreur lors de la publication de la réponse');}finally{setSubmitting(false);}};const handleReport=async()=>{if(!authService.getToken()){message.warning('Veuillez vous connecter pour signaler');navigate('/login');return;}try{await api.post(`/forum/discussions/${id}/report`);message.success('Signalement envoyé avec succès');}catch(error){message.error('Erreur lors du signalement');}};if(loading){return/*#__PURE__*/_jsx(\"div\",{children:\"Chargement...\"});}if(!discussion){return/*#__PURE__*/_jsx(\"div\",{children:\"Discussion non trouv\\xE9e\"});}return/*#__PURE__*/_jsx(Layout,{style:{padding:'24px'},children:/*#__PURE__*/_jsx(Content,{children:/*#__PURE__*/_jsxs(Space,{direction:\"vertical\",size:\"large\",style:{width:'100%'},children:[/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsxs(Space,{direction:\"vertical\",size:\"middle\",style:{width:'100%'},children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Title,{level:2,children:discussion.title}),/*#__PURE__*/_jsxs(Space,{children:[/*#__PURE__*/_jsx(Avatar,{src:discussion.author.avatar,children:discussion.author.name[0]}),/*#__PURE__*/_jsx(\"span\",{children:discussion.author.name}),/*#__PURE__*/_jsx(Tag,{color:\"blue\",children:discussion.category}),/*#__PURE__*/_jsx(\"span\",{children:new Date(discussion.createdAt).toLocaleDateString()})]})]}),/*#__PURE__*/_jsx(Paragraph,{children:discussion.content}),/*#__PURE__*/_jsxs(Space,{children:[/*#__PURE__*/_jsxs(Button,{icon:/*#__PURE__*/_jsx(LikeOutlined,{}),onClick:handleLike,children:[discussion.likesCount,\" J'aime\"]}),/*#__PURE__*/_jsxs(Button,{icon:/*#__PURE__*/_jsx(MessageOutlined,{}),children:[discussion.repliesCount,\" R\\xE9ponses\"]}),/*#__PURE__*/_jsx(Button,{icon:/*#__PURE__*/_jsx(FlagOutlined,{}),onClick:handleReport,children:\"Signaler\"})]})]})}),/*#__PURE__*/_jsxs(Divider,{children:[\"R\\xE9ponses (\",discussion.repliesCount,\")\"]}),/*#__PURE__*/_jsx(Space,{direction:\"vertical\",size:\"middle\",style:{width:'100%'},children:discussion.replies.map(reply=>/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsx(Card.Meta,{avatar:/*#__PURE__*/_jsx(Avatar,{src:reply.author.avatar,children:reply.author.name[0]}),title:/*#__PURE__*/_jsxs(Space,{children:[/*#__PURE__*/_jsx(\"span\",{children:reply.author.name}),/*#__PURE__*/_jsx(\"span\",{children:new Date(reply.createdAt).toLocaleDateString()})]}),description:reply.content})},reply.id))}),/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsxs(Space,{direction:\"vertical\",size:\"middle\",style:{width:'100%'},children:[/*#__PURE__*/_jsx(TextArea,{rows:4,value:replyContent,onChange:e=>setReplyContent(e.target.value),placeholder:\"Votre r\\xE9ponse...\"}),/*#__PURE__*/_jsx(Button,{type:\"primary\",onClick:handleReply,loading:submitting,children:\"Publier la r\\xE9ponse\"})]})})]})})});};export default DiscussionDetail;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}