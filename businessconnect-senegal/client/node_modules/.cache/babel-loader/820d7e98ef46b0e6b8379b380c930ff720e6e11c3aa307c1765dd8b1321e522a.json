{"ast":null,"code":"import React,{useState,useEffect}from'react';import{Table,Button,Space,Modal,message,Tag,Input,Typography}from'antd';import{adminService}from'../../../services/adminService';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const{TextArea}=Input;const{Title,Paragraph}=Typography;const ForumModeration=()=>{const[posts,setPosts]=useState([]);const[loading,setLoading]=useState(true);const[pagination,setPagination]=useState({current:1,pageSize:10,total:0});const[selectedPost,setSelectedPost]=useState(null);const[rejectReason,setRejectReason]=useState('');const[isModalVisible,setIsModalVisible]=useState(false);const fetchPosts=async function(){let page=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;let pageSize=arguments.length>1&&arguments[1]!==undefined?arguments[1]:10;try{setLoading(true);const response=await adminService.getForumPosts(page,pageSize);setPosts(response.data);setPagination({current:page,pageSize,total:response.total});}catch(error){message.error('Erreur lors du chargement des posts');}finally{setLoading(false);}};useEffect(()=>{fetchPosts();},[]);const handleTableChange=pagination=>{fetchPosts(pagination.current,pagination.pageSize);};const handleModeration=async(postId,action)=>{try{await adminService.moderatePost(postId,action,action==='reject'?rejectReason:undefined);message.success(`Post ${action==='approve'?'approuvé':'rejeté'} avec succès`);setIsModalVisible(false);setRejectReason('');fetchPosts(pagination.current,pagination.pageSize);}catch(error){message.error('Erreur lors de la modération');}};const showRejectModal=post=>{setSelectedPost(post);setIsModalVisible(true);};const getStatusColor=status=>{switch(status){case'approved':return'green';case'rejected':return'red';default:return'orange';}};const columns=[{title:'Titre',dataIndex:'title',key:'title'},{title:'Auteur',dataIndex:'author',key:'author'},{title:'Catégorie',dataIndex:'category',key:'category',render:category=>/*#__PURE__*/_jsx(Tag,{color:\"blue\",children:category})},{title:'Statut',dataIndex:'status',key:'status',render:status=>/*#__PURE__*/_jsx(Tag,{color:getStatusColor(status),children:status})},{title:'Date de création',dataIndex:'createdAt',key:'createdAt',render:date=>new Date(date).toLocaleDateString()},{title:'Signalements',dataIndex:'reports',key:'reports',render:reports=>/*#__PURE__*/_jsx(Tag,{color:reports>0?'red':'green',children:reports})},{title:'Actions',key:'actions',render:(_,record)=>/*#__PURE__*/_jsxs(Space,{children:[/*#__PURE__*/_jsx(Button,{type:\"primary\",onClick:()=>handleModeration(record.id,'approve'),disabled:record.status==='approved',children:\"Approuver\"}),/*#__PURE__*/_jsx(Button,{danger:true,onClick:()=>showRejectModal(record),disabled:record.status==='rejected',children:\"Rejeter\"}),/*#__PURE__*/_jsx(Button,{onClick:()=>Modal.info({title:'Contenu du post',content:/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Titre:\"}),\" \",record.title]}),/*#__PURE__*/_jsx(\"p\",{children:/*#__PURE__*/_jsx(\"strong\",{children:\"Contenu:\"})}),/*#__PURE__*/_jsx(\"p\",{children:record.content})]}),width:600}),children:\"Voir le contenu\"})]})}];return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Title,{level:4,children:\"Mod\\xE9ration du Forum\"}),/*#__PURE__*/_jsx(Table,{columns:columns,dataSource:posts,rowKey:\"id\",pagination:pagination,loading:loading,onChange:handleTableChange}),/*#__PURE__*/_jsx(Modal,{title:\"Raison du rejet\",visible:isModalVisible,onOk:()=>selectedPost&&handleModeration(selectedPost.id,'reject'),onCancel:()=>{setIsModalVisible(false);setRejectReason('');},okText:\"Confirmer\",cancelText:\"Annuler\",children:/*#__PURE__*/_jsx(TextArea,{rows:4,value:rejectReason,onChange:e=>setRejectReason(e.target.value),placeholder:\"Veuillez indiquer la raison du rejet...\"})})]});};export default ForumModeration;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}